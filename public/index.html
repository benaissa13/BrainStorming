<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brainstorming - Connexion</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 50px auto; padding: 20px; background: #f8f9fa; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .tabs { display: flex; margin-bottom: 30px; border-bottom: 2px solid #e9ecef; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; border: none; background: none; font-size: 16px; color: #6c757d; }
        .tab.active { color: #007bff; border-bottom: 2px solid #007bff; font-weight: bold; }
        .tab:hover { color: #007bff; }
        .form-content { display: none; }
        .form-content.active { display: block; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #007bff; box-shadow: 0 0 0 2px rgba(0,123,255,0.25); }
        button { width: 100%; padding: 14px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600; }
        button:hover { background: #0056b3; }
        .error { color: #dc3545; margin-top: 10px; padding: 10px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; }
        .success { color: #155724; margin-top: 10px; padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; }
        .form-section { margin-bottom: 25px; }
        .form-section h4 { color: #495057; margin-bottom: 15px; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .required { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="text-align: center; margin-bottom: 30px; color: #333;">üß† Plateforme Brainstorming</h2>

        <!-- Onglets -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('login')">Se connecter</button>
            <button class="tab" onclick="showTab('register')">S'inscrire</button>
        </div>

        <!-- Formulaire de connexion -->
        <div id="loginContent" class="form-content active">
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Nom d'utilisateur <span class="required">*</span></label>
                    <input type="text" id="loginUsername" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe <span class="required">*</span></label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit">Se connecter</button>
            </form>
        </div>

        <!-- Formulaire d'inscription -->
        <div id="registerContent" class="form-content">
            <form id="registerForm">
                <!-- Informations de connexion -->
                <div class="form-section">
                    <h4>Informations de connexion</h4>
                    <div class="form-group">
                        <label for="regUsername">Nom d'utilisateur <span class="required">*</span></label>
                        <input type="text" id="regUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Mot de passe <span class="required">*</span></label>
                        <input type="password" id="regPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="regEmail">Email <span class="required">*</span></label>
                        <input type="email" id="regEmail" required>
                    </div>
                </div>

                <!-- Informations personnelles -->
                <div class="form-section">
                    <h4>Informations personnelles</h4>
                    <div class="form-group">
                        <label for="regNom">Nom complet <span class="required">*</span></label>
                        <input type="text" id="regNom" required>
                    </div>
                    <div class="form-group">
                        <label for="regAdresse">Adresse</label>
                        <input type="text" id="regAdresse" placeholder="Ex: 12 Rue des Oliviers, Alger">
                    </div>
                    <div class="form-group">
                        <label for="regTelephone">T√©l√©phone</label>
                        <input type="tel" id="regTelephone" placeholder="Ex: +213661234567">
                    </div>
                    <div class="form-group">
                        <label for="regDateNaissance">Date de naissance</label>
                        <input type="date" id="regDateNaissance">
                    </div>
                    <div class="form-group">
                        <label for="regSexe">Sexe</label>
                        <select id="regSexe">
                            <option value="">S√©lectionner...</option>
                            <option value="Homme">Homme</option>
                            <option value="Femme">Femme</option>
                            <option value="Autre">Autre</option>
                        </select>
                    </div>
                </div>

                <!-- Informations professionnelles -->
                <div class="form-section">
                    <h4>Informations professionnelles</h4>
                    <div class="form-group">
                        <label for="regFonction">Fonction</label>
                        <input type="text" id="regFonction" placeholder="Ex: Ing√©nieur R&D">
                    </div>
                    <div class="form-group">
                        <label for="regProjet">Projet</label>
                        <input type="text" id="regProjet" placeholder="Ex: Automatisation 2025">
                    </div>
                    <div class="form-group">
                        <label for="regDiplome">Dipl√¥me</label>
                        <input type="text" id="regDiplome" placeholder="Ex: Master en informatique">
                    </div>
                </div>

                <button type="submit">S'inscrire</button>
            </form>
        </div>

        <div id="message"></div>
    </div>

    <script>
        // V√©rifier si d√©j√† connect√©
        fetch('/api/status')
            .then(res => res.json())
            .then(data => {
                if (data.authenticated) {
                    window.location.href = '/dashboard.html';
                }
            });

        // Gestion des onglets
        function showTab(tabName) {
            // Masquer tous les contenus
            document.querySelectorAll('.form-content').forEach(content => {
                content.classList.remove('active');
            });

            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Afficher le contenu s√©lectionn√©
            document.getElementById(tabName + 'Content').classList.add('active');

            // Activer l'onglet s√©lectionn√©
            event.target.classList.add('active');

            // Effacer les messages
            document.getElementById('message').innerHTML = '';
        }

        // Formulaire de connexion
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const messageDiv = document.getElementById('message');

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    messageDiv.innerHTML = '<div class="success">Connexion r√©ussie !</div>';
                    setTimeout(() => window.location.href = '/dashboard.html', 1000);
                } else {
                    messageDiv.innerHTML = '<div class="error">' + data.error + '</div>';
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="error">Erreur de connexion</div>';
            }
        });

        // Formulaire d'inscription
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                username: document.getElementById('regUsername').value,
                password: document.getElementById('regPassword').value,
                email: document.getElementById('regEmail').value,
                nom: document.getElementById('regNom').value,
                adresse: document.getElementById('regAdresse').value || null,
                telephone: document.getElementById('regTelephone').value || null,
                date_naissance: document.getElementById('regDateNaissance').value || null,
                sexe: document.getElementById('regSexe').value || null,
                fonction: document.getElementById('regFonction').value || null,
                projet: document.getElementById('regProjet').value || null,
                diplome: document.getElementById('regDiplome').value || null
            };

            const messageDiv = document.getElementById('message');

            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    messageDiv.innerHTML = '<div class="success">' + data.message + '</div>';
                    document.getElementById('registerForm').reset();
                    // Basculer vers l'onglet connexion apr√®s 2 secondes
                    setTimeout(() => {
                        showTab('login');
                        document.querySelector('.tab').click();
                    }, 2000);
                } else {
                    if (data.details) {
                        const errors = data.details.map(err => err.msg).join(', ');
                        messageDiv.innerHTML = '<div class="error">Erreurs: ' + errors + '</div>';
                    } else {
                        messageDiv.innerHTML = '<div class="error">' + data.error + '</div>';
                    }
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="error">Erreur lors de l\'inscription</div>';
            }
        });
    </script>
</body>
</html>